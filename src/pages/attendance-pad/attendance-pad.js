/**
 * ======================================================================
 * ğŸ§¾ attendance-pad.js
 * ----------------------------------------------------------------------
 * âœ… ì—­í• :
 * - ì¶œì„ë²ˆí˜¸ ì…ë ¥ íŒ¨ë“œ ë° í…Œë§ˆ(ë¼ì´íŠ¸/ë‹¤í¬) ì „í™˜ ê¸°ëŠ¥ ê´€ë¦¬
 * - ì „ì²´í™”ë©´ ì „í™˜ ë²„íŠ¼ ì œì–´ í¬í•¨
 * ----------------------------------------------------------------------
 * âš™ï¸ ì£¼ìš” ê¸°ëŠ¥:
 * 1ï¸âƒ£ ìë™ í…Œë§ˆ ê°ì§€ (ì‹œê°„ëŒ€ë³„ ë¼ì´íŠ¸/ë‹¤í¬ ëª¨ë“œ)
 * 2ï¸âƒ£ í† ê¸€ ìŠ¤ìœ„ì¹˜ë¡œ ìˆ˜ë™ í…Œë§ˆ ì „í™˜
 * 3ï¸âƒ£ ì¶œì„ë²ˆí˜¸ 4ìë¦¬ ì…ë ¥ ë° ì‚­ì œ/í™•ì¸ ê¸°ëŠ¥
 * 4ï¸âƒ£ ì „ì²´í™”ë©´ ì „í™˜ ë²„íŠ¼ (ì•„ì´ì½˜ ë° ìƒíƒœ ë™ê¸°í™”)
 * ----------------------------------------------------------------------
 * ğŸ§© Angular ë³€í™˜ ê°€ì´ë“œ:
 * - ì¶œì„íŒ¨ë“œ: `<app-attendance-pad>` ì»´í¬ë„ŒíŠ¸
 *   - ë‚´ë¶€ì—ì„œ `(click)` ì´ë²¤íŠ¸ â†’ FormControl ê°’ ì—…ë°ì´íŠ¸
 * - í…Œë§ˆ ì „í™˜: `ThemeService`ë¡œ ê´€ë¦¬ (`document.body.classList` ëŒ€ì‹  Service)
 * - ì „ì²´í™”ë©´ ì œì–´: `FullscreenDirective` ë˜ëŠ” CDK Overlay ê¸°ë°˜
 * ----------------------------------------------------------------------
 * ğŸª„ ê´€ë ¨ SCSS:
 * - attendance-pad.scss
 * - ë²„íŠ¼ ìŠ¤íƒ€ì¼, í‚¤íŒ¨ë“œ ë ˆì´ì•„ì›ƒ, ë‹¤í¬ëª¨ë“œ ìƒ‰ìƒ ì •ì˜ í¬í•¨
 * ======================================================================
 */

import "../../components/button/button.js";
import "./attendance-pad.scss";

/* ======================================================================
   ğŸŒ“ ì¶œì„ë²ˆí˜¸ ì…ë ¥ + í…Œë§ˆ í† ê¸€
   ----------------------------------------------------------------------
   âœ… ê¸°ëŠ¥:
   - í˜„ì¬ ì‹œê°„ëŒ€(7~18ì‹œ)ì— ë”°ë¼ ìë™ í…Œë§ˆ ê²°ì •
   - ì‚¬ìš©ìê°€ ìˆ˜ë™ìœ¼ë¡œ í…Œë§ˆ í† ê¸€ ê°€ëŠ¥
   - ì¶œì„ë²ˆí˜¸ ì…ë ¥(4ìë¦¬ ì œí•œ), ì‚­ì œ, í™•ì¸ ê¸°ëŠ¥ ì œê³µ
   ====================================================================== */
document.addEventListener("DOMContentLoaded", () => {
  /* =========================================================
     ğŸ¨ í…Œë§ˆ ìë™/ìˆ˜ë™ ì „í™˜
     ---------------------------------------------------------
     - ì˜¤ì „ 7ì‹œ~18ì‹œ: ë¼ì´íŠ¸ ëª¨ë“œ
     - ê·¸ ì™¸ ì‹œê°„: ë‹¤í¬ ëª¨ë“œ
     - ìˆ˜ë™ ì „í™˜: toggleSwitch change ì´ë²¤íŠ¸ë¡œ body í´ë˜ìŠ¤ ì œì–´
     ========================================================= */
  const toggleSwitch = document.getElementById("themeToggleSwitch");
  const hour = new Date().getHours();

  if (hour >= 7 && hour < 18) {
    document.body.classList.remove("dark-mode");
    toggleSwitch.checked = false;
  } else {
    document.body.classList.add("dark-mode");
    toggleSwitch.checked = true;
  }

  // [ìˆ˜ë™ ì „í™˜ ì´ë²¤íŠ¸]
  toggleSwitch.addEventListener("change", () => {
    document.body.classList.toggle("dark-mode", toggleSwitch.checked);
  });

  /* =========================================================
     ğŸ”¢ ì¶œì„ë²ˆí˜¸ ì…ë ¥ ë¡œì§
     ---------------------------------------------------------
     - 4ìë¦¬ ìˆ«ì ì…ë ¥ / ì‚­ì œ / í™•ì¸ ì²˜ë¦¬
     - span 4ê°œë¡œ ë””ìŠ¤í”Œë ˆì´ êµ¬ì„± (ë¹„ì–´ìˆì„ ê²½ìš° ë¹ˆì¹¸ í‘œì‹œ)
     ========================================================= */
  const display = document.getElementById("attendanceDisplay");
  const spans = display.querySelectorAll("span"); // 4ìë¦¬ ê³ ì •
  let inputDigits = [];

  // ë””ìŠ¤í”Œë ˆì´ ìˆ«ì ì—…ë°ì´íŠ¸
  function updateDisplay() {
    spans.forEach((span, i) => {
      span.textContent = inputDigits[i] || ""; // ì…ë ¥ ì—†ìœ¼ë©´ ë¹ˆì¹¸
    });
  }

  // í‚¤íŒ¨ë“œ ë²„íŠ¼ ì´ë²¤íŠ¸
  document.querySelectorAll(".attendance-pad__keypad .key").forEach((btn) => {
    btn.addEventListener("click", () => {
      if (btn.classList.contains("delete")) {
        // â¬… ë§ˆì§€ë§‰ ìˆ«ì ì‚­ì œ
        inputDigits.pop();
      } else if (btn.classList.contains("enter")) {
        // âœ… ì…ë ¥ ì™„ë£Œ (í˜„ì¬ ì½˜ì†” ì¶œë ¥)
        console.log("í™•ì¸:", inputDigits.join(""));
      } else {
        // ğŸ”¢ ìˆ«ì ì…ë ¥ (ìµœëŒ€ 4ìë¦¬ ì œí•œ)
        if (inputDigits.length < 4) {
          inputDigits.push(btn.textContent);
        }
      }
      updateDisplay();
    });
  });

  // ì´ˆê¸°í™” ì‹œ ë””ìŠ¤í”Œë ˆì´ ë¹„ì›€
  updateDisplay();
});

/* ======================================================================
   ğŸ–¥ ì „ì²´í™”ë©´ ì „í™˜ ë²„íŠ¼
   ----------------------------------------------------------------------
   âœ… ê¸°ëŠ¥:
   - ë²„íŠ¼ í´ë¦­ ì‹œ ì „ì²´í™”ë©´ ìš”ì²­ / ì¢…ë£Œ ì „í™˜
   - ì „ì²´í™”ë©´ ìƒíƒœ ë³€í™”(fullscreenchange) ê°ì§€í•˜ì—¬ ë²„íŠ¼ ì•„ì´ì½˜/í…ìŠ¤íŠ¸ ê°±ì‹ 
   ====================================================================== */
document.addEventListener("DOMContentLoaded", () => {
  const btn = document.getElementById("fullscreenBtn");
  const icon = btn.querySelector("i");

  /* =========================================================
     ğŸ”„ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
     ---------------------------------------------------------
     - ì „ì²´í™”ë©´ ì—¬ë¶€ì— ë”°ë¼ ì•„ì´ì½˜ ë° ë¼ë²¨ ë³€ê²½
     ========================================================= */
  function updateBtn() {
    if (document.fullscreenElement) {
      // ğŸŒ• ì „ì²´í™”ë©´ ìƒíƒœ
      icon.classList.remove("icon--arrows-out");
      icon.classList.add("icon--arrows-in");
      btn.classList.add("light");
      btn.innerHTML = `<i class="icon--arrows-in icon"></i> ì „ì²´í™”ë©´ ì¢…ë£Œ`;
    } else {
      // ğŸŒ‘ ì¼ë°˜ ìƒíƒœ
      icon.classList.remove("icon--arrows-in");
      icon.classList.add("icon--arrows-out");
      btn.classList.remove("light");
      btn.innerHTML = `<i class="icon--arrows-out icon"></i> ì „ì²´í™”ë©´`;
    }
  }

  /* =========================================================
     ğŸ–± í´ë¦­ ì´ë²¤íŠ¸ â†’ ì „ì²´í™”ë©´ ìš”ì²­ / ì¢…ë£Œ
     ========================================================= */
  btn.addEventListener("click", () => {
    if (!document.fullscreenElement) {
      document.documentElement.requestFullscreen(); // ì „ì²´í™”ë©´ ì‹œì‘
    } else {
      document.exitFullscreen(); // ì „ì²´í™”ë©´ ì¢…ë£Œ
    }
  });

  /* =========================================================
     ğŸ”” ì „ì²´í™”ë©´ ìƒíƒœ ë³€í™” ê°ì§€
     ---------------------------------------------------------
     - ì‚¬ìš©ìê°€ ESCë¡œ ì¢…ë£Œí•´ë„ ë²„íŠ¼ ìƒíƒœ ìë™ ê°±ì‹ 
     ========================================================= */
  document.addEventListener("fullscreenchange", updateBtn);

  // ì´ˆê¸° ìƒíƒœ ì„¸íŒ…
  updateBtn();
});
